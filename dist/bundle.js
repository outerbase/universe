!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(this,(()=>(()=>{"use strict";var e={};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,s(o.key),o)}}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function r(e){var t="function"==typeof Map?new Map:void 0;return r=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return i(e,arguments,c(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),l(n,e)},r(e)}function i(e,t,n){return i=a()?Reflect.construct.bind():function(e,t,n){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(e,o));return n&&l(r,n.prototype),r},i.apply(null,arguments)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function u(e,t,n){return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){var n=function(e,n){if("object"!==t(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!==t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===t(n)?n:String(n)}(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);var d=document.createElement("template");d.innerHTML='\n<style>\n    #editor-rows {\n        padding: 16px 0;\n        display: flex;\n        flex-direction: column;\n        height: 100%;\n        overflow-y: hidden;\n        background: #171717;\n    }\n</style>\n\n<div id="editor-rows">\n\n</div>\n';var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(v,e);var r,i,s,f,p,h=(f=v,p=a(),function(){var e,n=c(f);if(p){var r=c(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return function(e,n){if(n&&("object"===t(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return o(e)}(this,e)});function v(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v),u(o(e=h.call(this)),"container",null),u(o(e),"rowData",[]),u(o(e),"code",""),u(o(e),"draggedElement",null),u(o(e),"dropTarget",null),e.shadow=e.attachShadow({mode:"open"}),e.shadowRoot.innerHTML=d.innerHTML,e}return r=v,s=[{key:"observedAttributes",get:function(){return["code","readonly","show-line-numbers"]}}],(i=[{key:"redrawRowData",value:function(){var e=this;this.rowData=this.code.trim().split("\n").map((function(t,n){return{value:t=t.replace(/^ +/g,(function(e){return" ".repeat(e.length)})),lineNumber:(n+1).toString(),readonly:"true"===e.getAttribute("readonly")}})),0===this.rowData.length&&(this.rowData=[{value:""}]),this.render()}},{key:"attributeChangedCallback",value:function(e,t,n){"code"===e?(this.code=n,this.redrawRowData()):"readonly"===e?("true"===n?this.rowData.forEach((function(e,t){e.readonly=!0})):this.rowData.forEach((function(e,t){e.readonly=!1})),this.render()):"show-line-numbers"===e&&this.shadow.querySelector("#line-number-container")&&this.render()}},{key:"connectedCallback",value:function(){var e=this;this.render(),this.container=this.shadow.querySelector("#editor-rows"),this.container.addEventListener("dragstart",(function(t){e.draggedElement=t.target.closest("outerbase-editor-row"),t.dataTransfer.effectAllowed="move"})),this.container.addEventListener("dragover",(function(t){t.preventDefault();var n=t.target.closest("outerbase-editor-row");n&&n!==e.draggedElement&&(e.dropTarget=n,t.dataTransfer.dropEffect="move")})),this.container.addEventListener("dragend",(function(t){if(e.dropTarget){var n=e.getRowDataIndex(e.dropTarget),o=e.getRowDataIndex(e.draggedElement);e.rowData.splice(n,0,e.rowData.splice(o,1)[0]),e.rowData.forEach((function(e,t){e.lineNumber=(t+1).toString()})),e.render(),e.draggedElement=null,e.dropTarget=null}})),this.addEventListener("action-newline",(function(t){var n=t.detail.lineNumber,o=t.detail.textAfterCursor,r=t.detail.textToPersist;e.rowData.splice(n,0,{value:null!=o?o:""}),e.render(),n>0&&(e.rowData[n-1].value=null!=r?r:"",e.render());var i=e.getCodeDivFromLineNumber(n);i.contentEditable=!0,i.focus()})),this.addEventListener("action-delete",(function(t){var n,o=t.detail.lineNumber,r=t.detail.textAfterCursor;e.rowData.splice(o-1,1),o>1&&(e.rowData[o-2].value+=null!=r?r:""),e.render();var i=e.shadow.querySelector('outerbase-editor-row[data-index="'.concat(o-2,'"]'));if(i&&i.shadowRoot){var a=i.shadowRoot.querySelector("slot").assignedElements()[0].shadowRoot;if(a){var l=a.querySelector("#code");l.contentEditable=!0,l.focus(),0!==l.childNodes.length&&e.moveCursorToPosition(l,l.childNodes[0].length-(null!==(n=null==r?void 0:r.length)&&void 0!==n?n:0))}}})),this.addEventListener("action-update",(function(t){var n=t.detail.lineNumber,o=t.detail.value;e.rowData[n-1].value=o})),this.addEventListener("action-up",(function(t){var n=t.detail.lineNumber,o=t.detail.cursorPosition,r=e.shadow.querySelector('outerbase-editor-row[data-index="'.concat(n-2,'"]'));if(r&&r.shadowRoot){var i=r.shadowRoot.querySelector("slot").assignedElements()[0].shadowRoot;if(i){var a=i.querySelector("#code");a.contentEditable=!0,a.focus(),e.moveCursorToPosition(a,o)}}})),this.addEventListener("action-down",(function(t){var n=t.detail.lineNumber,o=t.detail.cursorPosition,r=e.shadow.querySelector('outerbase-editor-row[data-index="'.concat(n,'"]'));if(r&&r.shadowRoot){var i=r.shadowRoot.querySelector("slot").assignedElements()[0].shadowRoot;if(i){var a=i.querySelector("#code");a.contentEditable=!0,a.focus(),e.moveCursorToPosition(a,o)}}})),this.addEventListener("action-left",(function(t){var n=t.detail.lineNumber,o=e.shadow.querySelector('outerbase-editor-row[data-index="'.concat(n-2,'"]'));if(o&&o.shadowRoot){var r=o.shadowRoot.querySelector("slot").assignedElements()[0].shadowRoot;if(r){var i=r.querySelector("#code");i.contentEditable=!0,i.focus(),0!==i.childNodes.length&&e.moveCursorToPosition(i,i.childNodes[0].length)}}})),this.addEventListener("action-right",(function(t){var n=t.detail.lineNumber,o=e.shadow.querySelector('outerbase-editor-row[data-index="'.concat(n,'"]'));if(o&&o.shadowRoot){var r=o.shadowRoot.querySelector("slot").assignedElements()[0].shadowRoot;if(r){var i=r.querySelector("#code");i.contentEditable=!0,i.focus()}}}))}},{key:"getCodeDivFromLineNumber",value:function(e){var t=this.shadow.querySelector('outerbase-editor-row[data-index="'.concat(e,'"]'));if(t&&t.shadowRoot)return t.shadowRoot.querySelector("slot").assignedElements()[0].shadowRoot.querySelector("#code")}},{key:"moveCursorToPosition",value:function(e,t){var n=document.createRange(),o=window.getSelection();if(!e||0!==e.childNodes.length){var r=e.childNodes[0].length;n.setStart(e.childNodes[0],t>r?r:t),n.collapse(!0),o.removeAllRanges(),o.addRange(n)}}},{key:"getRowDataIndex",value:function(e){var t=e.getAttribute("data-index");return t?parseInt(t,10):null}},{key:"render",value:function(){var e=this;this.container=this.shadow.querySelector("#editor-rows"),this.container.innerHTML="",this.rowData.forEach((function(t,n){return e.createAndAppendRow(t,n)}))}},{key:"createAndAppendRow",value:function(e,t){var n,o=this.rowData.length.toString().length,r="9".repeat(o),i=document.createElement("outerbase-editor-row");if(i.setAttribute("line-number",t+1),i.setAttribute("max-line-number",r),i.setAttribute("data-index",t.toString()),i.setAttribute("readonly",e.readonly?"true":"false"),i.setAttribute("show-line-numbers",this.getAttribute("show-line-numbers")),null!==(n=e.value)&&void 0!==n&&n.startsWith("OB:WASM:")){e.isBlock=!0;var a=e.value.substring(8);e.blockContent=a;var l=document.createElement("div");l.style="width: 400px; height: 80px; font-family: 'Monaco', 'Courier New', monospace; font-size: 13px; color: white; background-color: rgb(33, 33, 33); border: 1px solid rgb(60, 60, 60); border-radius: 8px; padding: 8px 16px; margin: 8px 0;",l.textContent=e.blockContent,l.setAttribute("line-number",t+1),i.appendChild(l)}else{var c=document.createElement("outerbase-editor-row-text");c.setAttribute("line-number",t+1),c.setAttribute("value",e.value),c.setAttribute("readonly",e.readonly?"true":"false"),i.appendChild(c)}return this.container.appendChild(i),i}}])&&n(r.prototype,i),s&&n(r,s),Object.defineProperty(r,"prototype",{writable:!1}),v}(r(HTMLElement));function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function h(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==p(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!==p(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===p(r)?r:String(r)),o)}var r}function v(e){var t="function"==typeof Map?new Map:void 0;return v=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return b(e,arguments,m(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),w(n,e)},v(e)}function b(e,t,n){return b=y()?Reflect.construct.bind():function(e,t,n){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(e,o));return n&&w(r,n.prototype),r},b.apply(null,arguments)}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function w(e,t){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},w(e,t)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}window.customElements.define("outerbase-editor",f);var g=document.createElement("template");g.innerHTML='\n<style>\n    #container {\n        display: flex;\n    }\n\n    #max-line-number {\n        background-color: #171717;\n        font-family: \'Monaco\', \'Courier New\', monospace;\n        font-size: 13px;\n        line-height: 1.5;\n        text-align: right;\n        padding: 0px 0px 0px 8px;\n        height: 100%;\n        color: transparent;\n        -webkit-user-select: none; /* Safari */\n        -ms-user-select: none; /* IE 10 and IE 11 */\n        user-select: none; /* Standard syntax */\n    }\n\n    #line-number:hover {\n        background-color: #292929;\n        cursor: pointer;\n    }\n\n    #line-number {\n        position: absolute;\n        top: 0;\n        height: 100%;\n        text-align: right;\n        color: #4f4f4f;\n        font-family: \'Monaco\', \'Courier New\', monospace;\n        font-size: 13px;\n        line-height: 1.5;\n        -webkit-user-select: none; /* Safari */\n        -ms-user-select: none; /* IE 10 and IE 11 */\n        user-select: none; /* Standard syntax */\n        padding-right: 8px;\n    }\n\n    #row {\n        flex: 1;\n        padding: 0 0px;\n        position: relative;\n        margin-left: 16px;\n    }\n</style>\n\n<div id="container">\n    \x3c!-- Max line number is invisible, but serves a purpose of helping define how wide the element should be so all line numbers match up --\x3e\n    <div id="line-number-container" style="position: relative;">\n        <div id="max-line-number">1</div>\n        <div id="line-number">1</div>\n    </div>\n\n    \x3c!-- Row is the actual content we inject into the slot --\x3e\n    <div id="row">\n        <slot></slot>\n    </div>\n</div>\n';var x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&w(e,t)}(l,e);var t,n,o,r,i,a=(r=l,i=y(),function(){var e,t=m(r);if(i){var n=m(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===p(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(e=a.call(this)).shadow=e.attachShadow({mode:"open"}),e.shadowRoot.innerHTML=g.innerHTML,e}return t=l,o=[{key:"observedAttributes",get:function(){return["line-number","max-line-number","show-line-numbers","readonly"]}}],(n=[{key:"connectedCallback",value:function(){var e=this;this.shadowRoot.querySelector("#line-number").addEventListener("mousedown",(function(){"true"!==e.getAttribute("readonly")&&e.setAttribute("draggable","true")})),this.addEventListener("dragend",(function(){e.removeAttribute("draggable")})),this.render()}},{key:"attributeChangedCallback",value:function(e,t,n){"line-number"===e&&this.shadow.querySelector("#line-number")?this.shadow.querySelector("#line-number").innerHTML=n:"max-line-number"===e&&this.shadow.querySelector("#max-line-number")?this.shadow.querySelector("#max-line-number").innerHTML=n:"show-line-numbers"===e&&this.shadow.querySelector("#line-number-container")&&(this.shadow.querySelector("#line-number-container").style.display="true"===n?"block":"none"),this.render()}},{key:"render",value:function(){this.shadow.querySelector("#line-number").style.width=this.shadow.querySelector("#max-line-number").offsetWidth+"px"}}])&&h(t.prototype,n),o&&h(t,o),Object.defineProperty(t,"prototype",{writable:!1}),l}(v(HTMLElement));function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function E(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,P(o.key),o)}}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e){var t="function"==typeof Map?new Map:void 0;return k=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return T(e,arguments,O(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),R(n,e)},k(e)}function T(e,t,n){return T=C()?Reflect.construct.bind():function(e,t,n){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(e,o));return n&&R(r,n.prototype),r},T.apply(null,arguments)}function C(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function R(e,t){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},R(e,t)}function O(e){return O=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},O(e)}function P(e){var t=function(e,t){if("object"!==S(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!==S(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===S(t)?t:String(t)}window.customElements.define("outerbase-editor-row",x);var A=document.createElement("template");A.innerHTML='\n<style>\n    #container {\n        \n    }\n\n    ::selection {\n        background: rgba(40, 67, 115, 0.4);\n    }\n\n    pre {\n        margin: 0px;\n    }\n\n    #code {\n        position: absolute;\n        top: 0;\n        left: 0;\n        height: auto;\n        min-height: 100%;\n        overflow-y: hidden;\n        background: transparent;\n        color: transparent;\n        border: none;\n        outline: none;\n        resize: none;\n        width: 100%;\n        height: 100%;\n        caret-color: white;\n        cursor: text;\n        white-space: nowrap;\n    }\n\n    #highlight {\n        pointer-events: none;\n        white-space: nowrap;\n        user-select: none;\n        color: #9abbef;\n    }\n\n    #code, #highlight {\n        font-family: \'Monaco\', \'Courier New\', monospace;\n        font-size: 13px;\n        line-height: 1.5;\n        font-variant-numeric: tabular-nums;\n    }\n\n    #hint {\n        position: absolute;\n        color: #6a6a6a; /* Light grey color for the ghost text */\n        pointer-events: none; /* Makes the hint non-interactive */\n        font-family: \'Monaco\', \'Courier New\', monospace;\n        font-size: 13px;\n        line-height: 1.5;\n        user-select: none;\n        opacity: 0;\n        transition: opacity 0.2s ease-in-out;\n    }\n\n    .dropdown {\n        position: absolute;\n        border: 1px solid rgb(47, 47, 47);\n        background-color: rgb(60, 60, 60);\n        z-index: 1000;\n        top: 20px;\n        left: 0px;\n        border-radius: 8px;\n        overflow: hidden;\n    }\n\n    .dropdown-item {\n        padding: 6px 16px;\n        min-width: 200px;\n        cursor: pointer;\n        color: white;\n        font-family: \'Monaco\', \'Courier New\', monospace;\n        font-size: 13px;\n    }\n\n    .dropdown-item:first-child {\n        padding-top: 8px;\n    }\n\n    .dropdown-item:last-child {\n        padding-bottom: 8px;\n    }\n\n    .dropdown-item:hover {\n        background-color: rgb(40, 40, 40);\n    }\n\n    .dropdown-item.selected {\n        background-color: rgb(40, 40, 40);\n    }\n\n    .keyword { color: #98d7c8; }\n    .string { color: #d99ad9; }\n    .braces { color: #e4c945; }\n    .variable-name { color: white; }\n    .comment { color: #6a6a6a; }\n    .request { \n        color: gray;\n        text-decoration: underline;\n        text-underline-offset: 4px;\n    }\n    .secret { \n        color: rgba(0, 0, 0, 0.85);\n        -webkit-filter: blur(0px); /* Required, or background color on ::before won\'t work */\n    }\n    .secret::before {\n        content: \'\';\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        width: calc(100% + 4px); /* 4px wider than the container */\n        height: calc(100% + 6px); /* 4px taller than the container */\n        background-color: #a099e8;\n        z-index: -1;\n        transform: translate(-50%, -50%); /* Center the pseudo-element */\n        border-radius: 4px;\n    }\n    \n</style>\n\n<div id="container">\n    <pre><code id="highlight"></code></pre>\n    <div id="code" contentEditable="false" spellcheck="false"></div>\n\n    \x3c!-- Show a line hint when the line is empty and cursor is active --\x3e\n    <div id="hint" style="display: block;">Type \'/\' for a list of code block suggestions.</div>\n\n    \x3c!-- "/" options to show --\x3e\n    <div id="dropdown" class="dropdown" style="display: none;">\n        <div class="dropdown-item" data-value="OB:WASM:Slack">Slack</div>\n        <div class="dropdown-item" data-value="OB:WASM:Mailgun">Mailgun</div>    \n    </div>\n</div>\n';var j=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}(l,e);var t,n,o,r,i,a=(r=l,i=C(),function(){var e,t=O(r);if(i){var n=O(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===S(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return D(e)}(this,e)});function l(){var e,t,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),t=D(e=a.call(this)),-1,(n=P(n="selectedItemIndex"))in t?Object.defineProperty(t,n,{value:-1,enumerable:!0,configurable:!0,writable:!0}):t[n]=-1,e.shadow=e.attachShadow({mode:"open"}),e.shadowRoot.innerHTML=A.innerHTML,e}return t=l,o=[{key:"observedAttributes",get:function(){return["line-number","value","readonly"]}}],(n=[{key:"changeContentEditable",value:function(e){this.contentEditable=e,this.updateHint()}},{key:"getCursorPosition",value:function(){var e=this.shadowRoot.getSelection?this.shadowRoot.getSelection():window.getSelection();if(!e||0===e.rangeCount)return 0;var t=e.getRangeAt(0),n=t.cloneRange();return n.selectNodeContents(this.codeDiv),n.setEnd(t.endContainer,t.endOffset),n.toString().length}},{key:"selectText",value:function(){this.shadowRoot;var e=this.codeDiv;if(e){var t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}}},{key:"connectedCallback",value:function(){var e=this;this.codeDiv=this.shadowRoot.querySelector("#code"),this.codeDiv.addEventListener("input",(function(){var t=e.getAttribute("line-number");e.updateCode(),e.updateHint(),e.dispatchEvent(new CustomEvent("action-update",{bubbles:!0,composed:!0,detail:{lineNumber:t,value:e.codeDiv.innerText}}))})),this.codeDiv.addEventListener("keyup",(function(t){return e.checkForSlash(t.target)})),this.codeDiv.addEventListener("keydown",(function(t){var n=e.getAttribute("line-number");if(("ArrowUp"===t.key||"ArrowDown"===t.key||"Enter"===t.key)&&e.codeDiv.innerText.length&&"/"===e.codeDiv.innerText[e.codeDiv.innerText.length-1]&&"none"!==e.shadow.querySelector("#dropdown").style.display)return t.preventDefault(),void e.navigateDropdown(t.key);if("ArrowUp"===t.key){var o=e.getCursorPosition(e.codeDiv);return t.preventDefault(),void e.dispatchEvent(new CustomEvent("action-up",{bubbles:!0,composed:!0,detail:{lineNumber:n,cursorPosition:o}}))}if("ArrowDown"===t.key)return t.preventDefault(),void e.dispatchEvent(new CustomEvent("action-down",{bubbles:!0,composed:!0,detail:{lineNumber:n,cursorPosition:e.getCursorPosition(e.codeDiv)}}));if("ArrowLeft"===t.key){var r=e.codeDiv.innerText;if(0===(o=e.getCursorPosition(e.codeDiv)))return t.preventDefault(),void e.dispatchEvent(new CustomEvent("action-left",{bubbles:!0,composed:!0,detail:{lineNumber:n}}))}if("ArrowRight"===t.key&&(r=e.codeDiv.innerText,(o=e.getCursorPosition(e.codeDiv))===r.length))return t.preventDefault(),void e.dispatchEvent(new CustomEvent("action-right",{bubbles:!0,composed:!0,detail:{lineNumber:n}}));if("Backspace"===t.key){r=e.codeDiv.innerText,o=e.getCursorPosition(e.codeDiv);var i={lineNumber:n,textAfterCursor:u=(r=e.codeDiv.innerText).substring(o)};if(0===o)return t.preventDefault(),void e.dispatchEvent(new CustomEvent("action-delete",{bubbles:!0,composed:!0,detail:i}))}if("Enter"!==t.key){if("Tab"===t.key){t.preventDefault(),o=e.getCursorPosition(e.codeDiv);var a=(r=e.codeDiv.innerText).substring(0,o);u=r.substring(o),e.codeDiv.innerText=a+"    "+u,e.updateCode(),e.updateHint();var l=document.createRange(),c=window.getSelection();return l.setStart(e.codeDiv.childNodes[0],e.codeDiv.childNodes[0].length),l.collapse(!0),c.removeAllRanges(),c.addRange(l),e.moveCursorToPosition(e.codeDiv,o+4),void e.dispatchEvent(new CustomEvent("action-update",{bubbles:!0,composed:!0,detail:{lineNumber:n,value:e.codeDiv.innerText}}))}}else{t.preventDefault();o=e.getCursorPosition(e.codeDiv);var u,s={lineNumber:n,textAfterCursor:u=(r=e.codeDiv.innerText).substring(o),textToPersist:r.substring(0,o)};e.dispatchEvent(new CustomEvent("action-newline",{bubbles:!0,composed:!0,detail:s}))}})),this.codeDiv.addEventListener("focus",(function(){"true"!==e.getAttribute("readonly")?(e.codeDiv.contentEditable=!0,e.updateHint()):e.codeDiv.blur()})),this.codeDiv.addEventListener("blur",(function(){e.codeDiv.contentEditable=!1,e.updateHint(),setTimeout((function(){e.shadow.querySelector("#hint").style.opacity="0"}),400)})),this.codeDiv.addEventListener("click",(function(){e.codeDiv.contentEditable=!0,document.activeElement!==e.codeDiv&&e.codeDiv.focus(),e.updateHint()})),this.shadowRoot.querySelectorAll(".dropdown-item").forEach((function(t){t.addEventListener("click",(function(){var n=t.getAttribute("data-value");e.insertText(n)}))})),this.render()}},{key:"attributeChangedCallback",value:function(e,t,n){"value"===e&&(this.shadow.querySelector("#code").innerText=n),this.render()}},{key:"render",value:function(){this.updateCode()}},{key:"updateCode",value:function(){var e=this.shadow.querySelector("#code").innerText;e=(e=(e=(e=(e=(e=(e=(e=this.escapeHtml(e)).replace(/(&#039;|&quot;)(.*?)(&#039;|&quot;)/g,'<span class="string">$&</span>')).replace(/(var|let|const|function|return|if|else|for|while|break|continue)/g,'<span class="keyword">$1</span>')).replace(/(\/\/.*)/g,'<span class="comment">$1</span>')).replace(/(\/\*[\s\S]*?\*\/)/g,'<span class="comment">$1</span>')).replace(/{{SECRET\..+?}}/g,'<span class="secret">$&</span>')).replace(/{{request\..+?}}/g,'<span class="request">$&</span>')).replace(/(?<!\{)\{(?!\{)|(?<!\})\}(?!\})/g,'<span class="braces">$&</span>'),this.shadow.querySelector("#highlight").innerHTML=e}},{key:"escapeHtml",value:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}},{key:"moveCursorToPosition",value:function(e,t){var n=document.createRange(),o=window.getSelection();if(!e||0!==e.childNodes.length){var r=e.childNodes[0].length;n.setStart(e.childNodes[0],t>r?r:t),n.collapse(!0),o.removeAllRanges(),o.addRange(n)}}},{key:"checkForSlash",value:function(e){var t=e.innerText,n=e.selectionStart,o=t.substring(0,n).split("\n").pop(),r=o.lastIndexOf("/");if(0===r){var i=o.substring(r+1);this.filterAndShowDropdown(i)}else this.hideDropdown()}},{key:"filterAndShowDropdown",value:function(e){for(var t=this.shadow.querySelector("#dropdown"),n=t.getElementsByClassName("dropdown-item"),o=!1,r=0;r<n.length;r++){var i=n[r];i.textContent.toLowerCase().includes(e.toLowerCase())?(i.style.display="",o=!0):i.style.display="none"}t.style.display=o?"":"none"}},{key:"updateHint",value:function(){var e=this.shadow.querySelector("#code"),t=this.shadow.querySelector("#hint"),n=e.selectionStart,o=e.innerText.substring(0,n);if(0===o.split("\n").pop().length&&"true"===this.codeDiv.contentEditable){var r=parseInt(window.getComputedStyle(e).lineHeight,1.5),i=(o.split("\n").length-1)*r;t.style.top=i+"2px",t.style.left="4px",setTimeout((function(){t.style.opacity="1"}),500)}else{if("true"!==this.codeDiv.contentEditable)return void(t.style.opacity="0");t.style.display="none",t.style.opacity="0",setTimeout((function(){t.style.display="block"}),300)}}},{key:"showDropdown",value:function(){this.selectedItemIndex=-1,this.shadow.querySelector("#dropdown").style.display="block"}},{key:"hideDropdown",value:function(){this.shadow.querySelector("#dropdown").style.display="none"}},{key:"insertText",value:function(e){this.codeDiv.innerText=e,this.updateCode(),this.updateHint(),this.hideDropdown();var t=this.getAttribute("line-number"),n={lineNumber:t,textToPersist:e=this.codeDiv.innerText};this.dispatchEvent(new CustomEvent("action-update",{bubbles:!0,composed:!0,detail:{lineNumber:t,value:this.codeDiv.innerText}})),this.dispatchEvent(new CustomEvent("action-newline",{bubbles:!0,composed:!0,detail:n}))}},{key:"navigateDropdown",value:function(e){var t=this,n=this.shadow.querySelector("#dropdown"),o=Array.from(n.getElementsByClassName("dropdown-item")).filter((function(e){return"none"!==e.style.display}));if("ArrowDown"===e)this.selectedItemIndex=(this.selectedItemIndex+1)%o.length;else if("ArrowUp"===e)this.selectedItemIndex=(this.selectedItemIndex-1+o.length)%o.length;else if("Enter"===e&&-1!==this.selectedItemIndex){var r=o[this.selectedItemIndex].getAttribute("data-value");return this.insertText(r),void this.hideDropdown()}o.forEach((function(e,n){e.classList.toggle("selected",n===t.selectedItemIndex)}))}}])&&E(t.prototype,n),o&&E(t,o),Object.defineProperty(t,"prototype",{writable:!1}),l}(k(HTMLElement));return window.customElements.define("outerbase-editor-row-text",j),e})()));